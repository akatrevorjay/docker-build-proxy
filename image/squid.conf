# settings that you may want to customize
# ---------------------------------------

# this file contains private networks (10.0.0.0/8, 172.16.0.0/12,
# 192.168.0.0/16) by default, you can add/remove additional allowed
# source networks in it to customize it for your setup
acl allowed_networks src "$CONFIG_DIR/autogenerated/allowed-networks-src.acl"

# this contains the package blacklist
acl blockedpkgs urlpath_regex "$CONFIG_DIR/autogenerated/pkg-blacklist-regexp.acl"

# default to a different port than stock squid
http_port 3142

# -------------------------------------------------
# settings below probably do not need customization

# user visible name
visible_hostname docker-caching-proxy

# we need a big cache, some debs are huge
maximum_object_size 512 MB

# use a different dir than stock squid and default to 40G
cache_dir aufs $CACHE_DIR 40000 16 256

# use different logs
cache_access_log $LOG_DIR/access.log
cache_log $LOG_DIR/cache.log
cache_store_log $LOG_DIR/store.log

# tweaks to speed things up
cache_mem 64 MB
maximum_object_size_in_memory 10240 KB

# pid
pid_filename /var/run/docker-caching-proxy.pid

# refresh pattern for debs and udebs
refresh_pattern deb$   129600 100% 129600
refresh_pattern udeb$   129600 100% 129600
refresh_pattern tar.gz$  129600 100% 129600
refresh_pattern tar.xz$  129600 100% 129600
refresh_pattern tar.bz2$  129600 100% 129600
refresh_pattern zip$  129600 100% 129600

# always refresh Packages and Release files
refresh_pattern \/(Packages|Sources)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims
refresh_pattern \/Release(|\.gpg)$ 0 0% 0 refresh-ims
refresh_pattern \/InRelease$ 0 0% 0 refresh-ims
refresh_pattern \/(Translation-.*)(|\.bz2|\.gz|\.xz)$ 0 0% 0 refresh-ims

# handle meta-release and changelogs.ubuntu.com special
# (fine to have this on debian too)
refresh_pattern changelogs.ubuntu.com\/.*  0  1% 1

# do not allow to download from the pkg blacklist
http_access deny blockedpkgs

# allow access from our network and localhost
http_access allow allowed_networks

# And finally deny all other access to this proxy
http_access deny all

# we don't want to clash with the squid3 netdb state file
netdb_filename stdio:$LOG_DIR/netdb.state
